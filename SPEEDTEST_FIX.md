# 测速结果写入节点名称修复说明

## 问题描述

之前的版本中，测速功能虽然已经实现，但存在一个逻辑问题：当节点的测速结果低于配置的最小阈值时，节点会被完全过滤掉，测速结果不会写入节点名称。

## 问题原因

在 `src/main.rs` 的两个位置（第287行和第344行附近），当节点速度低于阈值或测速失败时，代码使用了 `continue` 语句直接跳过节点处理，导致：

1. 节点没有被添加到 `processed_nodes` 列表
2. 节点名称没有被更新（包含速度信息）
3. 测速结果完全丢失

## 修复方案

### 修改逻辑流程

1. **分离节点命名和节点过滤逻辑**：
   - 无论速度是否达到阈值，都先生成包含速度信息的节点名称
   - 然后再根据速度阈值决定是否保留节点

2. **使用标志变量控制节点保留**：
   - 引入 `should_keep_node` 变量来标记节点是否应该被保留
   - 避免使用 `continue` 语句跳过节点名称生成

3. **改进错误处理**：
   - 测速失败的节点名称显示为 `_0MB`
   - 确保所有节点都有完整的命名信息

### 修复后的行为

- ✅ **速度达到阈值的节点**：保留节点，名称包含实际速度（如 `_2.5MB`）
- ✅ **速度低于阈值的节点**：过滤节点，但名称仍包含实际速度（如 `_1.2MB`）
- ✅ **测速失败的节点**：过滤节点，名称显示为 `_0MB`

## 测试验证

修复后的代码已通过编译测试：
```bash
cargo check  # ✅ 通过
cargo build  # ✅ 通过
```

## 配置文件

确保在 `conf/config.toml` 中启用测速功能：
```toml
[speed_test]
enabled = true
url = "https://speed.cloudflare.com/__down?bytes=10485760"
timeout = 15000
min_speed_mbps = 2.0
```

## 预期效果

修复后，所有进行过测速的节点都会在名称中显示速度信息，无论是否通过速度阈值测试。这样用户可以看到完整的测速结果，同时仍然可以通过配置阈值来过滤低速节点。