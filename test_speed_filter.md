# 速度过滤功能测试说明

## 功能概述

已成功实现移除下载速度小于2MB/s的节点功能。

## 实现的修改

### 1. 配置文件更新 (`conf/config.toml`)
- 添加了 `min_speed_mbps = 2.0` 配置项
- 设置最小速度阈值为 2.0 MB/s

### 2. 数据结构更新 (`src/speedtest.rs`)
- 在 `SpeedTestConfig` 结构体中添加了 `min_speed_mbps: f64` 字段

### 3. 主逻辑更新 (`src/main.rs`)
- 在两个测速位置都添加了速度过滤逻辑
- 当节点速度低于阈值时，会记录错误日志并跳过该节点
- 测速失败的节点也会被过滤

### 4. 文档更新 (`SPEEDTEST_FEATURE.md`)
- 更新了配置参数说明
- 添加了速度过滤的注意事项
- 更新了版本日志

## 工作原理

1. **速度测试**: 对每个通过连通性测试的节点进行带宽测速
2. **速度检查**: 将测得的速度（KB/s）转换为 MB/s
3. **阈值比较**: 与配置的 `min_speed_mbps` 进行比较
4. **节点过滤**: 
   - 速度 >= 2.0 MB/s: 保留节点
   - 速度 < 2.0 MB/s: 过滤节点，记录日志
   - 测速失败: 过滤节点，记录日志

## 日志输出示例

```
「节点名称」测速完成: 1.5 MB/s
「节点名称」速度 1.5 MB/s 低于最小阈值 2.0 MB/s，已过滤
```

## 配置建议

- **保守设置**: `min_speed_mbps = 1.0` (1 MB/s)
- **标准设置**: `min_speed_mbps = 2.0` (2 MB/s) - 当前默认
- **严格设置**: `min_speed_mbps = 5.0` (5 MB/s)

## 测试方法

1. 确保配置文件中 `speed_test.enabled = true`
2. 设置合适的 `min_speed_mbps` 值
3. 运行程序: `cargo run`
4. 观察日志输出，确认低速节点被正确过滤